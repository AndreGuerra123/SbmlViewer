<template src="./tool-bar.html"></template>
<style lang="scss" src="./tool-bar.scss"></style>
<script>
import { readXmlUpload } from '../../utilites/readXmlUpload'
import $ from 'jquery'

export default {
  name: 'ToolBar',
  props: [
    'options'
  ],
  data () {
    return {
      isSpin: false,
      fileName: 'No file choosen',
      optionsDisplay: {
        'useNames': {
          'title': ' \'names\' as identifiers',
          'notes': 'Use \'names\' attribute instead of \'id\' attribute. Turn on the option for models with very long or uninformative ids'
        },
        'correctMathml': {
          'title': ' correctons to MathML',
          'notes': 'Make some correction for MathML generated by SimBiology. Some of SimBiology models generate wrong MathML. Try this option if something looks wrong in equations.'
        },
        'equationsOff': {
          'title': ' Turn off equations',
          'notes': 'Use this option if you are not interested in math. It reduces time of transformation.'
        }
      },
      waysDisplayPage: [
        'sbml2table',
        'sbml2math'
      ],
      xslt: 'sbml2table',
      file: null
    }
  },
  mounted () {
    this.$root.$on('startSpin', () => {
      this.isSpin = true
    })
    this.$root.$on('stopSpin', () => {
      this.isSpin = false
    })
    this.dragNdropInit()
  },
  methods: {
    onChooseFile: function (e) {
      e.preventDefault()
      this.file = document.getElementById('file').files[0]
      this.changeFile()
    },
    changeFile: function () {
      this.fileName = this.file.name
      document.getElementsByTagName('title')[0].innerHTML = this.file.name
      readXmlUpload(this.file, (result) => {
        this.$emit('onLoadFile', result.rawHTML)
      })
    },
    changeOption: function (optName) {
      this.options[optName] = !this.options[optName]
    },
    onSelectXslt: function () {
      this.options.transform = this.xslt
      readXmlUpload(this.file, (result) => {
        this.$emit('selectedXslt', this.xslt, result.rawHTML)
      })
    },
    dragNdropInit: function () {
      $(document).on('dragover', function (e) {
        e.preventDefault()
      })
      $(document).on('dragstart', function (e) {
        e.preventDefault()
      })
      $(document).on('drop', (e) => {
        e.preventDefault()
        this.file = e.originalEvent.dataTransfer.files[0]
        this.changeFile()
      })
    }
  }
}
</script>
